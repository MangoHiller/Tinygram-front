"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getImports = void 0;
const parseTemplate_1 = require("./parseTemplate");
const importMap_json_1 = __importDefault(require("vuetify/dist/json/importMap.json"));
/** key: module ID, value: resolved components */
const componentsMap = new Map();
const directivesMap = new Map();
function getImports(source, id) {
    const { components, directives } = (0, parseTemplate_1.parseTemplate)(source);
    const resolvedComponents = componentsMap.get(id) || (componentsMap.set(id, new Set()), componentsMap.get(id));
    const resolvedDirectives = directivesMap.get(id) || (directivesMap.set(id, new Set()), directivesMap.get(id));
    const imports = new Map();
    const componentsStart = resolvedComponents.size;
    const directivesStart = resolvedDirectives.size;
    if (components.size || directives.size) {
        addImport(imports, 'installAssets', '@vuetify/loader-shared/runtime');
        components.forEach(name => {
            if (name in importMap_json_1.default.components) {
                resolvedComponents.add(name);
            }
        });
        directives.forEach(name => {
            if (importMap_json_1.default.directives.includes(name)) {
                resolvedDirectives.add(name);
            }
        });
    }
    resolvedComponents.forEach(name => {
        addImport(imports, name, 'vuetify/lib/' + importMap_json_1.default.components[name].from);
    });
    resolvedDirectives.forEach(name => {
        addImport(imports, name, 'vuetify/lib/directives/index.mjs');
    });
    const hasNewImports = resolvedComponents.size > componentsStart ||
        resolvedDirectives.size > directivesStart;
    return {
        imports,
        hasNewImports,
        components: Array.from(resolvedComponents),
        directives: Array.from(resolvedDirectives),
    };
}
exports.getImports = getImports;
function addImport(imports, name, from) {
    if (!imports.has(from)) {
        imports.set(from, []);
    }
    imports.get(from).push(name);
}
//# sourceMappingURL=getImports.js.map