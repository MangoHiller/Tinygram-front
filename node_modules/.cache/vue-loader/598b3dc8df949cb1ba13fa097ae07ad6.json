{"remainingRequest":"/home/hugo_leguillier/tinygram-2022-2023/front/node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!/home/hugo_leguillier/tinygram-2022-2023/front/src/views/Home.vue?vue&type=style&index=0&id=1b425ef3&scoped=true&lang=css","dependencies":[{"path":"/home/hugo_leguillier/tinygram-2022-2023/front/src/views/Home.vue","mtime":1669404036193},{"path":"/home/hugo_leguillier/tinygram-2022-2023/front/node_modules/css-loader/dist/cjs.js","mtime":1668093919371},{"path":"/home/hugo_leguillier/tinygram-2022-2023/front/node_modules/vue-loader/dist/stylePostLoader.js","mtime":1668093920179},{"path":"/home/hugo_leguillier/tinygram-2022-2023/front/node_modules/postcss-loader/dist/cjs.js","mtime":1668093919963},{"path":"/home/hugo_leguillier/tinygram-2022-2023/front/node_modules/cache-loader/dist/cjs.js","mtime":1668093903975},{"path":"/home/hugo_leguillier/tinygram-2022-2023/front/node_modules/vue-loader/dist/index.js","mtime":1668093920179}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmlucHV0W3R5cGU9J2ZpbGUnXSB7CiAgZGlzcGxheTogbm9uZTsKfQoKLnRpbWVsaW5lLWNvbnRhaW5lciB7CiAgbWluLWhlaWdodDogMTAwdmg7CiAgdGV4dC1hbGlnbjogbGVmdDsKICBwYWRkaW5nOiAwcHggMTRweCAwcHggMTRweDsKICBtYXgtd2lkdGg6IDYwMHB4Owp9CgoubmV3LXBvc3QtY29udGFpbmVyIHsKICB3aWR0aDogMTAwJTsKICBtaW4taGVpZ2h0OiAxODBweDsKICBib3JkZXItcmFkaXVzOiAxMnB4OwogIGJhY2tncm91bmQtY29sb3I6ICMyMDUwMzA7CiAgcGFkZGluZzogMjRweDsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47Cn0KCi5uZXctcG9zdC1jb250YWluZXIgLm1lc3NhZ2UtaW5wdXQgewogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogMTMwcHg7CiAgbWluLWhlaWdodDogMTMwcHg7CiAgcmVzaXplOiBub25lOwogIGNvbG9yOiB3aGl0ZTsKCiAgYm9yZGVyOiBub25lOwogIG92ZXJmbG93OiBhdXRvOwogIG91dGxpbmU6IG5vbmU7CgogIC13ZWJraXQtYm94LXNoYWRvdzogbm9uZTsKICAtbW96LWJveC1zaGFkb3c6IG5vbmU7CiAgYm94LXNoYWRvdzogbm9uZTsKfQoKLm5ldy1wb3N0LWNvbnRhaW5lciAuYnV0dG9ucyB7CiAgbWFyZ2luLXRvcDogMTJweDsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiByb3c7CiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KCi5uZXctcG9zdC1jb250YWluZXIgLmJ1dHRvbnMgLnYtYnRuIHsKICBjb2xvcjogd2hpdGU7CiAgYmFja2dyb3VuZC1jb2xvcjogIzEwMjgxODsKfQoKLyogbWVkaWEgcXVlcnkgbWF4IHdpZHRoIDQyNHB4ICovCkBtZWRpYSAobWF4LXdpZHRoOiA0MjRweCkgewogIC5uZXctcG9zdC1jb250YWluZXIgLmJ1dHRvbnMgewogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIGFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0OwogIH0KCiAgLm5ldy1wb3N0LWNvbnRhaW5lciAuYnV0dG9ucyAudi1idG4gewogICAgbWFyZ2luLXRvcDogMTJweDsKICB9Cn0K"},{"version":3,"sources":["/home/hugo_leguillier/tinygram-2022-2023/front/src/views/Home.vue"],"names":[],"mappings":"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","file":"/home/hugo_leguillier/tinygram-2022-2023/front/src/views/Home.vue","sourceRoot":"","sourcesContent":["<template>\n  <v-container align=\"center\" justify=\"center\">\n    <div class=\"timeline-container\">\n      <div class=\"new-post-container\">\n        <textarea\n          v-if=\"getUser()?.followers\"\n          v-model=\"description\"\n          class=\"message-input\"\n          :placeholder=\"placeholderText\"\n        ></textarea>\n\n        <div class=\"buttons\">\n          <input type=\"file\" id=\"fileInput\" ref=\"inputFile\" @change=\"updateFile\" />\n          <v-btn tag=\"label\" for=\"fileInput\" style=\"color: white\">\n            <v-icon>mdi-paperclip</v-icon>&nbsp;{{ file ? file.name : 'Attach' }}\n          </v-btn>\n\n          <v-btn @click=\"createPost\" :disabled=\"uploading\" style=\"color: white; background-color: #102818\">\n            <Satellite />&nbsp;Broadcast </v-btn\n          ><v-btn @click=\"bulkCreatePost(30)\" :disabled=\"uploading\" style=\"color: white; background-color: #102818\">\n            <Satellite />&nbsp;BULK Broadcast\n          </v-btn>\n        </div>\n      </div>\n      <div class=\"posts-container\" v-if=\"posts.length > 0\">\n        <TimelinePost v-for=\"post in posts\" :key=\"post.id\" :data=\"post\" />\n      </div>\n      <div class=\"posts-container\" style=\"text-align: center\" v-else>\n        <br />\n        <h4 style=\"color:  #205030; font-weight: 400\">\n          Votre timeline semble très vide :(<br />\n          Vous devriez <strong>explore</strong> un peu plus pour trouver plus de contenu!\n        </h4>\n        <v-btn tag=\"router-link\" to=\"/explore\" class=\"mt-2\" style=\"color: white; background-color: #205030\">\n          <Observatory />&nbsp;Explore\n        </v-btn>\n      </div>\n      <div\n        v-show=\"fetching\"\n        style=\"\n          color: white;\n          text-align: center;\n          height: 100px;\n          justify-content: center;\n          align-items: center;\n          display: flex;\n        \"\n      >\n        LOADING\n      </div>\n    </div>\n  </v-container>\n</template>\n\n<script lang=\"ts\">\nimport Satellite from '@/components/CustomIcon/Satellite.vue';\nimport { defineComponent } from 'vue';\nimport axios from '@/plugins/axios';\nimport { mapActions, mapGetters } from 'vuex';\nimport Observatory from '@/components/CustomIcon/Observatory.vue';\nimport TimelinePost from '@/components/Posts/TimelinePost.vue';\n\nexport default defineComponent({\n  name: 'Home',\n\n  components: {\n    Satellite,\n    TimelinePost,\n    Observatory,\n  },\n\n  data() {\n    return {\n      file: null,\n      description: '',\n      before: '',\n      after: '',\n      posts: [],\n      uploading: false,\n      fetching: false,\n    };\n  },\n\n  async mounted() {\n    if ((this as any).isLoggedIn()) {\n      (this as any).retrieveUser();\n      const data = await (this as any).getPosts('');\n\n      if (data?.items?.length) {\n        (this as any).posts = data.items;\n        (this as any).before = data.previous;\n        (this as any).after = data.next;\n      }\n    } else {\n      (this as any).$router.push('/');\n    }\n\n    (this as any).scrollDetector();\n  },\n\n  computed: {\n    placeholderText() {\n      const followerCount = (this as any).getUser().followers;\n      return `Partagez vos pensées ${\n        followerCount > 0\n          ? 'avec vos ' + followerCount + ' followers' + (followerCount == 1 ? '' : 's') + '!'\n          : 'space!'\n      }`;\n    },\n  },\n\n  methods: {\n    ...mapGetters(['isLoggedIn', 'getUser']),\n    ...mapActions(['retrieveUser']),\n\n    updateFile(e: any) {\n      if (e?.target?.files?.[0]) {\n        (this as any).file = e.target.files[0];\n      } else {\n        (this as any).file = null;\n        (window as any).document.getElementById('fileInput').value = null;\n      }\n    },\n\n    scrollDetector() {\n      window.onscroll = async () => {\n        let bottomOfWindow =\n          Math.ceil(\n            Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop) +\n              window.innerHeight,\n          ) >= document.documentElement.offsetHeight;\n        if (bottomOfWindow && !(this as any).fetching) {\n          (this as any).fetching = true;\n          try {\n            const data = await (this as any).getPosts((this as any)?.after);\n\n            if (data?.items?.length) {\n              // merge (this as any).posts with data.items\n              const existingPostsIds = (this as any).posts.map((post: any) => post.id);\n\n              data.items = data.items.filter((newPost: any) => {\n                return !existingPostsIds.includes(newPost.id);\n              });\n\n              (this as any).posts = [...(this as any).posts, ...data.items];\n              (this as any).before = data.previous;\n              (this as any).after = data.next;\n            }\n\n            (this as any).fetching = false;\n          } catch (e) {\n            (this as any).fetching = false;\n            console.error(e);\n          }\n        }\n      };\n    },\n\n    async getPosts(after: string) {\n      const res = await axios.get(`/timeline${after ? '?after=' + after : ''}`);\n\n      if ((res as any)?.data?.items) {\n        return (res as any)?.data;\n      }\n    },\n\n    async bulkCreatePost(count: number) {\n      (this as any).description = `Post`;\n      const file = (this as any).file;\n\n      if ((this as any).file && (this as any)?.description.length > 0) {\n        for (let i = 0; i < count; i++) {\n          (this as any).description = `Post ${i}`;\n          (this as any).file = file;\n          await (this as any).createPost();\n        }\n      }\n    },\n\n    async createPost() {\n      if ((this as any).file && (this as any)?.description.length > 0) {\n        (this as any).uploading = true;\n        try {\n          const post = await axios.post('/posts', {\n            fileName: (this as any).file.name,\n            fileType: (this as any).file.type,\n            description: (this as any).description,\n          });\n\n          if ((post as any)?.data?.uploadURL) {\n            await fetch((post as any)?.data?.uploadURL, {\n              method: 'PUT', \n              headers: {\n                'Content-Type': (this as any).file.type,               \n              },\n              body: (this as any).file,\n            });\n\n            const publishedPost = await axios.post(`/posts/${(post as any)?.data?.id}/publish`);\n\n            (this as any).description = '';\n            (this as any).updateFile(null);\n\n            const data = await (this as any).getPosts('');\n\n            if (data?.items?.length) {\n              (this as any).posts = data.items;\n              (this as any).before = data.previous;\n              (this as any).after = data.next;\n            }\n\n            (this as any).uploading = false;\n            return publishedPost;\n          }\n        } catch (e) {\n          (this as any).uploading = false;\n          console.error(e);\n          return e;\n        }\n      } else {\n        return null;\n      }\n    },\n  },\n});\n</script>\n\n<style scoped>\ninput[type='file'] {\n  display: none;\n}\n\n.timeline-container {\n  min-height: 100vh;\n  text-align: left;\n  padding: 0px 14px 0px 14px;\n  max-width: 600px;\n}\n\n.new-post-container {\n  width: 100%;\n  min-height: 180px;\n  border-radius: 12px;\n  background-color: #205030;\n  padding: 24px;\n  display: flex;\n  flex-direction: column;\n}\n\n.new-post-container .message-input {\n  width: 100%;\n  height: 130px;\n  min-height: 130px;\n  resize: none;\n  color: white;\n\n  border: none;\n  overflow: auto;\n  outline: none;\n\n  -webkit-box-shadow: none;\n  -moz-box-shadow: none;\n  box-shadow: none;\n}\n\n.new-post-container .buttons {\n  margin-top: 12px;\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.new-post-container .buttons .v-btn {\n  color: white;\n  background-color: #102818;\n}\n\n/* media query max width 424px */\n@media (max-width: 424px) {\n  .new-post-container .buttons {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n\n  .new-post-container .buttons .v-btn {\n    margin-top: 12px;\n  }\n}\n</style>\n"]}]}